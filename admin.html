<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>GbzStore — Admin Panel</title>

<!-- Firebase compat libraries -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
  :root{
    --bg:#07101a; --panel:#0b1116; --muted:#9fb0c2; --accent:#ff8a00; --danger:#ff5a5a; --ok:#22c55e; --card:#071922; --border: rgba(255,255,255,0.04);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--bg),#031021);color:#e8f5ff}
  .wrap{display:flex;min-height:100vh}
  aside{width:260px;background:var(--panel);padding:18px;border-right:1px solid var(--border);position:fixed;left:0;top:0;bottom:0}
  main{margin-left:260px;padding:20px;flex:1}
  .brand{display:flex;gap:10px;align-items:center;margin-bottom:12px}
  .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#ff5a5a);display:flex;align-items:center;justify-content:center;font-weight:800;color:#071018}
  h1{font-size:16px;margin:0}
  nav button{display:block;width:100%;text-align:left;padding:10px;border-radius:8px;border:none;background:transparent;color:var(--muted);margin-bottom:6px;cursor:pointer;font-weight:700}
  nav button.active{background:rgba(255,255,255,0.02);color:#fff;border:1px solid var(--border)}
  .panel{background:linear-gradient(180deg,transparent,rgba(255,255,255,0.01));padding:12px;border-radius:8px;border:1px solid var(--border)}
  .row{display:flex;gap:8px;align-items:center}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;margin-top:12px}
  .card{background:var(--card);padding:12px;border-radius:10px;border:1px solid var(--border)}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);font-size:14px}
  .muted{color:var(--muted);font-size:13px}
  .btn{padding:8px 10px;border-radius:8px;border:0;background:var(--accent);color:#071018;font-weight:800;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid var(--border);color:var(--muted)}
  .btn.warn{background:var(--danger);color:#111}
  .btn.ok{background:var(--ok);color:#011}
  input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid var(--border);background:transparent;color:inherit;margin-top:6px}
  .small{font-size:13px;color:var(--muted)}
  .search{display:flex;gap:8px;align-items:center}
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:1200}
  .modal.open{display:flex}
  .dialog{background:#071022;padding:16px;border-radius:10px;width:100%;max-width:900px;border:1px solid var(--border)}
  .log{font-family:monospace; font-size:12px; color:#cfe;}
  .notice{padding:8px;border-radius:8px;background:#081427;border:1px solid rgba(255,255,255,0.02);margin-top:6px}
  @media (max-width:900px){ aside{position:relative;width:100%;display:flex;flex-direction:row;gap:8px;overflow:auto} main{margin-left:0;padding:12px} }
</style>
</head>
<body>
<div class="wrap">

  <!-- SIDEBAR -->
  <aside>
    <div class="brand">
      <div class="logo">GT</div>
      <div><h1>GbzStore Admin</h1><div class="small muted">Painel seguro</div></div>
    </div>

    <nav>
      <button class="nav-btn active" data-view="overview">Visão geral</button>
      <button class="nav-btn" data-view="manage-games">Gerenciar jogos</button>
      <button class="nav-btn" data-view="manage-reports">Denúncias</button>
      <button class="nav-btn" data-view="logs">Logs / Intrusões</button>
      <button class="nav-btn" data-view="settings">Configurações</button>
      <button class="nav-btn" data-view="logout">Sair</button>
    </nav>

    <div style="margin-top:12px" class="panel">
      <div class="small">Status anti-hack: <strong id="anti-status">ativado</strong></div>
      <div style="margin-top:8px" class="small">Versão: <strong>GbzAdmin v1</strong></div>
    </div>
  </aside>

  <!-- MAIN -->
  <main>
    <!-- LOGIN / SESSION -->
    <div id="login-wrap" class="panel" style="max-width:520px;margin-bottom:12px;">
      <h2>Login Admin</h2>
      <p class="small">Painel administrativo — protótipo com senha fixa (use em ambiente controlado).</p>
      <label>Usuário</label>
      <input id="admin-user" placeholder="admin">
      <label>Senha</label>
      <input id="admin-pass" type="password" placeholder="••••••">
      <div style="margin-top:8px;display:flex;gap:8px;">
        <button id="btn-login" class="btn">Entrar</button>
        <button id="btn-cancel-login" class="btn ghost">Limpar</button>
      </div>
      <div id="login-msg" class="small muted" style="margin-top:8px"></div>
    </div>

    <!-- VIEWS -->
    <div id="overview" class="view" style="display:none">
      <h2>Visão geral</h2>
      <div class="grid">
        <div class="card">
          <strong>Total de jogos</strong>
          <div id="total-games" class="small" style="margin-top:8px">0</div>
        </div>
        <div class="card">
          <strong>Total de cliques</strong>
          <div id="total-clicks" class="small" style="margin-top:8px">0</div>
        </div>
        <div class="card">
          <strong>Denúncias</strong>
          <div id="total-reports" class="small" style="margin-top:8px">0</div>
        </div>
      </div>

      <div style="margin-top:14px" class="card">
        <h3>Últimos envios</h3>
        <div id="recent-games" style="margin-top:8px"></div>
      </div>
    </div>

    <div id="manage-games" class="view" style="display:none">
      <h2>Gerenciar jogos</h2>
      <div class="panel">
        <div class="search">
          <input id="search-games" placeholder="Pesquisar por nome ou tag">
          <select id="filter-approved">
            <option value="all">Todos</option>
            <option value="approved">Aprovados</option>
            <option value="pending">Pendente</option>
          </select>
          <button id="btn-search-games" class="btn ghost">Pesquisar</button>
        </div>

        <div style="margin-top:12px;overflow:auto;max-height:420px">
          <table id="games-table">
            <thead><tr><th>Nome</th><th>Tag</th><th>Cliques</th><th>Aprovado</th><th>Ações</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="manage-reports" class="view" style="display:none">
      <h2>Denúncias</h2>
      <div id="reports-panel" class="panel">
        <div id="reports-list">Carregando...</div>
      </div>
    </div>

    <div id="logs" class="view" style="display:none">
      <h2>Logs / Intrusões</h2>
      <div class="card" style="max-height:480px;overflow:auto;">
        <pre id="logs-content" class="log">Carregando logs...</pre>
      </div>
      <div style="margin-top:12px">
        <button id="btn-clear-logs" class="btn ghost">Limpar logs (apagar nó intrusions)</button>
      </div>
    </div>

    <div id="settings" class="view" style="display:none">
      <h2>Configurações</h2>
      <div class="panel">
        <label>Permitir uploads públicos</label>
        <select id="setting-allow-uploads"><option value="true">Sim</option><option value="false">Não</option></select>

        <label style="margin-top:8px">Detectar DevTools (anti-hack)</label>
        <select id="setting-detect-devtools"><option value="true">Ativar</option><option value="false">Desativar</option></select>

        <div style="margin-top:12px;display:flex;gap:8px;">
          <button id="btn-save-settings" class="btn">Salvar</button>
          <button id="btn-load-settings" class="btn ghost">Recarregar</button>
        </div>
        <div id="settings-msg" class="small muted" style="margin-top:8px"></div>
      </div>
    </div>

  </main>
</div>

<!-- MODAL: Edit Game -->
<div id="modal-edit" class="modal" aria-hidden="true">
  <div class="dialog">
    <h3>Editar jogo</h3>
    <label>Nome</label><input id="edit-name">
    <label>Descrição</label><textarea id="edit-desc"></textarea>
    <label>Imagem URL</label><input id="edit-img">
    <label>Link</label><input id="edit-link">
    <label>Altura (px)</label><input id="edit-height" type="number" min="80" max="600" value="160">
    <label>Aprovado</label>
    <select id="edit-approved"><option value="true">Sim</option><option value="false">Não</option></select>
    <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
      <button id="edit-cancel" class="btn ghost">Cancelar</button>
      <button id="edit-save" class="btn">Salvar</button>
    </div>
    <div id="edit-msg" class="small muted" style="margin-top:8px"></div>
  </div>
</div>

<script>
/* =======================
   Firebase init
   ======================= */
const firebaseConfig = {
  apiKey: "AIzaSyBfUH7E-il5iOttjtHKqrqiYsFAmNt9d5s",
  authDomain: "booyahmind.firebaseapp.com",
  databaseURL: "https://booyahmind-default-rtdb.firebaseio.com",
  projectId: "booyahmind",
  storageBucket: "booyahmind.firebasestorage.app",
  messagingSenderId: "893667760259",
  appId: "1:893667760259:web:4796b60789ed9916b0a3b6"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* =======================
   Globals + helpers
   ======================= */
const GAMES = 'games';
const REPORTS = 'reports';
const SETTINGS = 'settings';
const INTRUSIONS = 'intrusions';
let adminSession = false; // becomes true after login
let gamesCache = [];

const qs = s => document.querySelector(s);
const qsa = s => Array.from(document.querySelectorAll(s));
const el = (t,c,html)=>{const e=document.createElement(t); if(c) e.className=c; if(html!==undefined) e.innerHTML=html; return e;};

function sanitize(s){ if(!s) return ''; return String(s).replace(/<\/?[^>]+(>|$)/g,"").trim(); }
function isValidUrl(u){ try{ const url=new URL(u); return ['http:','https:'].includes(url.protocol); }catch(e){return false;} }

/* =======================
   AUTH (simple) - protótipo
   ======================= */
const ADMIN_PASSWORD = 'admin123'; // protótipo: senha fixa
const ADMIN_USER = 'admin';

qs('#btn-login').addEventListener('click', ()=>{
  const user = qs('#admin-user').value.trim();
  const pass = qs('#admin-pass').value;
  if(user !== ADMIN_USER || pass !== ADMIN_PASSWORD){
    qs('#login-msg').textContent = 'Usuário ou senha incorretos.';
    return;
  }
  // set session (very simple)
  sessionStorage.setItem('gbz_admin','1');
  adminSession = true;
  qs('#login-wrap').style.display = 'none';
  showView('overview');
  initAfterAuth();
});

/* logout */
qsa('.nav-btn[data-view="logout"]').forEach(b=>{
  b.addEventListener('click', ()=>{
    sessionStorage.removeItem('gbz_admin');
    adminSession = false;
    location.reload();
  });
});

/* showView helper */
function showView(id){
  qsa('.view').forEach(v=>v.style.display='none');
  const v = qs('#'+id);
  if(v) v.style.display='block';
  qsa('.nav-btn').forEach(nb=>nb.classList.toggle('active', nb.getAttribute('data-view')===id));
}

/* if session exists, auto login */
if(sessionStorage.getItem('gbz_admin')==='1'){
  adminSession = true;
  qs('#login-wrap').style.display = 'none';
  showView('overview');
  initAfterAuth();
}

/* =======================
   DB Listeners & render
   ======================= */
function initAfterAuth(){
  setupListeners();
  attachUIHandlers();
  detectDevTools(); // start detection loop
}

/* Fetch games & render table */
function setupListeners(){
  db.ref(GAMES).on('value', snap=>{
    const val = snap.val() || {};
    gamesCache = Object.keys(val).map(k=>Object.assign({id:k}, val[k]));
    // normalize fields
    gamesCache = gamesCache.map(g=>{
      return {
        id: g.id,
        name: g.name || g.nome || '',
        desc: g.desc || '',
        img: g.img || g.imagem || '',
        link: g.link || g.link || '',
        height: g.height || g.altura || 160,
        approved: g.approved === true || g.approved === 'true' ? true : false,
        clicks: Number(g.clicks || 0),
        ts: g.ts || 0
      };
    });
    // sort newest
    gamesCache.sort((a,b)=> (b.ts||0) - (a.ts||0));
    renderOverview();
    renderGamesTable();
    renderRecent();
    updateStats();
  });

  db.ref(REPORTS).on('value', snap=>{
    const val = snap.val() || {};
    const arr = Object.keys(val).map(k=>Object.assign({id:k}, val[k]));
    renderReports(arr);
  });

  db.ref(INTRUSIONS).on('value', snap=>{
    const val = snap.val() || {};
    const arr = Object.keys(val).map(k=>Object.assign({id:k}, val[k]));
    renderLogs(arr);
  });

  // settings reflect
  db.ref(SETTINGS).once('value').then(snap=>{
    const st = snap.val() || {};
    qs('#setting-allow-uploads').value = st.allowUploads===false ? 'false' : 'true';
    qs('#setting-detect-devtools').value = st.detectDevtools===false ? 'false' : 'true';
  });
}

/* Rendering functions */
function renderOverview(){
  qs('#total-games').textContent = gamesCache.length;
  const totalClicks = gamesCache.reduce((s,g)=>s+(g.clicks||0),0);
  qs('#total-clicks').textContent = totalClicks;
  // recent games list
  renderRecent();
}

function renderRecent(){
  const wrap = qs('#recent-games');
  wrap.innerHTML = '';
  gamesCache.slice(0,6).forEach(g=>{
    const c = el('div','panel');
    c.style.marginBottom='8px';
    c.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${sanitize(g.name)}</strong><div class="small muted">${sanitize(g.desc||g.tag||'')}</div></div><div class="small">${g.clicks||0} clicks</div></div>`;
    wrap.appendChild(c);
  });
}

function renderGamesTable(){
  const tbody = qs('#games-table tbody');
  tbody.innerHTML = '';
  const filter = qs('#filter-approved').value;
  const q = qs('#search-games').value.trim().toLowerCase();
  gamesCache.forEach(g=>{
    if(filter==='approved' && !g.approved) return;
    if(filter==='pending' && g.approved) return;
    if(q && !( (g.name||'').toLowerCase().includes(q) || (g.tag||'').toLowerCase().includes(q) )) return;
    const tr = document.createElement('tr');
    const nameTd = el('td',null, sanitize(g.name));
    const tagTd = el('td',null, sanitize(g.tag||''));
    const clicksTd = el('td',null, String(g.clicks||0));
    const apprTd = el('td',null, g.approved ? 'Sim' : 'Não');
    const actionsTd = el('td',null,'');
    // actions: approve/unapprove, edit, delete, set clicks
    const btnApprove = el('button','btn ok', g.approved ? 'Reprovar' : 'Aprovar');
    btnApprove.addEventListener('click', ()=> toggleApprove(g.id, !g.approved));
    const btnEdit = el('button','btn ghost','Editar');
    btnEdit.addEventListener('click', ()=> openEditModal(g));
    const btnDelete = el('button','btn warn','Excluir');
    btnDelete.addEventListener('click', ()=> deleteGame(g.id));
    const btnInc = el('button','btn secondary','+click');
    btnInc.addEventListener('click', ()=> incrementClicks(g.id,1));
    const btnDec = el('button','btn ghost','-click');
    btnDec.addEventListener('click', ()=> incrementClicks(g.id,-1));
    actionsTd.append(btnApprove, btnEdit, btnInc, btnDec, btnDelete);
    tr.appendChild(nameTd); tr.appendChild(tagTd); tr.appendChild(clicksTd); tr.appendChild(apprTd); tr.appendChild(actionsTd);
    tbody.appendChild(tr);
  });
}

/* Reports rendering */
function renderReports(arr){
  qs('#total-reports').textContent = arr.length;
  const node = qs('#reports-list'); node.innerHTML = '';
  if(arr.length===0){ node.innerHTML = '<div class="card">Sem denúncias</div>'; return; }
  arr.forEach(r=>{
    const c = el('div','card');
    const info = `<div><strong>Link/ID:</strong> ${sanitize(r.link||'')}</div><div class="small muted">Enviado: ${new Date(r.ts||0).toLocaleString()}</div>`;
    const reason = `<div style="margin-top:8px">${sanitize(r.reason||'')}</div>`;
    const resolve = el('button','btn ok','Resolver');
    resolve.addEventListener('click', ()=> resolveReport(r.id));
    const remove = el('button','btn ghost','Excluir');
    remove.addEventListener('click', ()=> deleteReport(r.id));
    c.innerHTML = info + reason;
    c.appendChild(el('div','row','',''));
    c.querySelector('.row')?.append(resolve, remove);
    node.appendChild(c);
  });
}

/* Logs render */
function renderLogs(arr){
  const p = qs('#logs-content');
  if(!arr || arr.length===0) { p.textContent = 'Sem registros'; return; }
  // show newest first
  p.textContent = arr.slice(-200).reverse().map(r=>`${new Date(r.ts||0).toLocaleString()} | ${r.type} | ${JSON.stringify(r).slice(0,300)}`).join('\n\n');
}

/* =======================
   Actions: edit/approve/delete/clicks
   ======================= */
function toggleApprove(id, to){
  db.ref(`${GAMES}/${id}/approved`).set(Boolean(to)).then(()=> console.log('Aprovado atualizado'));
}
function openEditModal(g){
  qs('#modal-edit').classList.add('open');
  qs('#modal-edit').setAttribute('aria-hidden','false');
  qs('#edit-name').value = g.name||'';
  qs('#edit-desc').value = g.desc||'';
  qs('#edit-img').value = g.img||'';
  qs('#edit-link').value = g.link||'';
  qs('#edit-height').value = g.height||160;
  qs('#edit-approved').value = g.approved ? 'true':'false';
  qs('#edit-save').onclick = ()=> saveEdit(g.id);
}
qs('#edit-cancel').addEventListener('click', ()=> {
  qs('#modal-edit').classList.remove('open'); qs('#modal-edit').setAttribute('aria-hidden','true');
});
function saveEdit(id){
  const payload = {
    name: sanitize(qs('#edit-name').value),
    desc: sanitize(qs('#edit-desc').value),
    img: qs('#edit-img').value.trim(),
    link: qs('#edit-link').value.trim(),
    height: Number(qs('#edit-height').value) || 160,
    approved: qs('#edit-approved').value === 'true'
  };
  db.ref(`${GAMES}/${id}`).update(payload).then(()=> {
    qs('#edit-msg').textContent = 'Salvo.'; setTimeout(()=>{qs('#modal-edit').classList.remove('open');qs('#modal-edit').setAttribute('aria-hidden','true'); qs('#edit-msg').textContent='';},900);
  }).catch(err=>{ qs('#edit-msg').textContent = 'Erro ao salvar.'; console.error(err); });
}

function deleteGame(id){
  if(!confirm('Excluir jogo permanentemente?')) return;
  db.ref(`${GAMES}/${id}`).remove().then(()=> alert('Removido.'));
}

/* increment clicks safely (transaction) */
function incrementClicks(id, delta){
  const ref = db.ref(`${GAMES}/${id}/clicks`);
  ref.transaction(curr=>{
    curr = Number(curr || 0) + Number(delta);
    if(curr < 0) curr = 0;
    return curr;
  }, (err, committed, snapshot)=>{
    if(err) console.error(err);
    if(committed) {
      console.log('Clicks updated', snapshot.val());
      // update UI quickly
      renderGamesTable();
    }
  });
}

/* reports actions */
function resolveReport(id){
  db.ref(`${REPORTS}/${id}`).update({resolved:true, resolvedTs: Date.now()});
}
function deleteReport(id){
  if(!confirm('Excluir denúncia?')) return;
  db.ref(`${REPORTS}/${id}`).remove();
}

/* clear logs (intrusions) */
qs('#btn-clear-logs').addEventListener('click', ()=>{
  if(!confirm('Apagar registros de intrusão?')) return;
  db.ref(INTRUSIONS).set(null).then(()=> alert('Logs apagados.'));
});

/* =======================
   Settings save/load
   ======================= */
qs('#btn-load-settings').addEventListener('click', ()=>{
  db.ref(SETTINGS).once('value').then(snap=>{
    const s = snap.val() || {};
    qs('#setting-allow-uploads').value = s.allowUploads===false ? 'false':'true';
    qs('#setting-detect-devtools').value = s.detectDevtools===false ? 'false':'true';
    qs('#settings-msg').textContent = 'Carregado.';
    setTimeout(()=> qs('#settings-msg').textContent='',1200);
  });
});
qs('#btn-save-settings').addEventListener('click', ()=>{
  const allow = qs('#setting-allow-uploads').value === 'true';
  const detect = qs('#setting-detect-devtools').value === 'true';
  db.ref(SETTINGS).set({ allowUploads: allow, detectDevtools: detect }).then(()=> {
    qs('#settings-msg').textContent = 'Salvo.';
    setTimeout(()=> qs('#settings-msg').textContent='',1200);
  }).catch(e=>{ qs('#settings-msg').textContent = 'Erro ao salvar.'; });
});

/* =======================
   SEARCH / filter handlers
   ======================= */
qs('#btn-search-games').addEventListener('click', ()=> renderGamesTable());
qs('#filter-approved').addEventListener('change', ()=> renderGamesTable());
qs('#search-games').addEventListener('input', ()=> renderGamesTable());

/* =======================
   ANTI-HACK: detect DevTools & script injection logging
   ======================= */
let devtoolsDetected = false;
function detectDevTools(){
  const threshold = 160;
  const widthCond = window.outerWidth - window.innerWidth > threshold;
  const heightCond = window.outerHeight - window.innerHeight > threshold;
  devtoolsDetected = widthCond || heightCond;
  // small perf timing trick
  try{
    const start = performance.now();
    debugger;
    const elapsed = performance.now() - start;
    if(elapsed > 100) devtoolsDetected = true;
  }catch(e){}
  qs('#anti-status').textContent = devtoolsDetected ? 'detectado' : 'ativado';
  // log to DB quickly if detected
  if(devtoolsDetected){
    db.ref(INTRUSIONS).push({type:'devtools-detect', ua:navigator.userAgent, ts: Date.now()});
  }
}
setInterval(detectDevTools, 1500);

/* mutation observer to detect script injection */
const mo = new MutationObserver(muts=>{
  muts.forEach(m=>{
    if(m.addedNodes && m.addedNodes.length){
      m.addedNodes.forEach(node=>{
        if(node.tagName && node.tagName.toLowerCase()==='script'){
          db.ref(INTRUSIONS).push({type:'script-injection', src: node.src || 'inline', ts: Date.now(), ua: navigator.userAgent});
          try{ node.remove(); }catch(e){}
        }
      });
    }
  });
});
mo.observe(document.documentElement, {childList:true, subtree:true});

/*=======================
   Logs render utility
=======================*/
function renderLogsNow(){
  db.ref(INTRUSIONS).limitToLast(200).once('value').then(snap=>{
    const val = snap.val() || {};
    const arr = Object.keys(val).map(k=>Object.assign({id:k}, val[k]));
    renderLogs(arr);
  });
}

/* =======================
   Utilities on load
   ======================= */
function updateStats(){
  // compute totals
  const total = gamesCache.length;
  const clicks = gamesCache.reduce((s,g)=>s+(Number(g.clicks)||0),0);
  const reportsCount = 0; // updated by listener
  qs('#total-games').textContent = total;
  qs('#total-clicks').textContent = clicks;
}

/* initialize if session already present */
if(adminSession) initAfterAuth();

/* small helper: export games JSON */
function exportGamesJSON(){
  const data = JSON.stringify(gamesCache, null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'gbz-games-admin-export.json'; a.click();
  URL.revokeObjectURL(url);
}

/* connect small UI actions */
qs('#btn-export')?.addEventListener('click', exportGamesJSON);

</script>

<!--
  INSTRUÇÃO: para contar cliques globalmente a partir da página pública, adicione este código
  no lugar onde você abre o link do jogo (ex: no botão 'Abrir' ou ao clicar no card).
  Exemplo (público page JS):

  // assumindo firebase inicializado e db = firebase.database()
  function openGameAndCount(gameId, link){
    // incrementa contador com transaction (seguro para concorrência)
    const ref = db.ref('games/' + gameId + '/clicks');
    ref.transaction(curr => {
      return (Number(curr) || 0) + 1;
    }).then(() => {
      window.open(link, '_blank');
    }).catch(err => {
      // mesmo se falhar contador, continuamos abrindo
      window.open(link, '_blank');
    });
  }

  Em vez de window.open(link) direto, chame openGameAndCount(gameId, link).

  IMPORTANTE: para que isso funcione, seus jogos devem ter o campo "clicks" (número) no Realtime Database.
-->

</body>
</html>
