<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>GbzStore — Painel (Loja de Games)</title>

<!-- (Opcional) Firebase compat - descomente se for usar -->
<!--
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
-->

<style>
  /* === Tema "antigo / duro" (clean, painel lateral) === */
  :root{
    --bg:#0b0d10;
    --panel:#0f1317;
    --muted:#9aa9b6;
    --accent:#ff8a00;
    --accent-2:#00d4ff;
    --card:#0b1116;
    --border:rgba(255,255,255,0.03);
    --danger:#ff5555;
    --success:#22c55e;
    --glass: rgba(255,255,255,0.02);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--bg),#051018);color:#e6eef8}
  /* Layout */
  .app{display:flex;min-height:100vh}
  aside.sidebar{
    width:260px;background:linear-gradient(180deg,var(--panel),#07101a);border-right:1px solid var(--border);
    padding:20px;display:flex;flex-direction:column;gap:12px;position:fixed;left:0;top:0;bottom:0;
  }
  .logo{
    display:flex;align-items:center;gap:12px;padding-bottom:6px;border-bottom:1px solid var(--border);
  }
  .logo .mark{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#ff5a5a);display:flex;align-items:center;justify-content:center;font-weight:800;color:#071018}
  .logo h1{font-size:16px;margin:0}
  nav.menu{display:flex;flex-direction:column;gap:8px;margin-top:8px;}
  button.nav-btn{
    background:transparent;border:1px solid transparent;padding:10px 12px;border-radius:8px;color:var(--muted);text-align:left;cursor:pointer;font-weight:700;
    transition:all .14s ease;
  }
  button.nav-btn:hover{transform:translateX(4px)}
  button.nav-btn.active{background:var(--glass);border-color:var(--border);color:#fff}
  .sidebar .section-title{font-size:12px;color:var(--muted);margin-top:8px;margin-bottom:6px}
  .sidebar .small{font-size:12px;color:var(--muted)}
  /* Main content */
  .main{margin-left:260px;padding:20px;flex:1;min-height:100vh}
  .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:16px}
  .topbar .left{display:flex;gap:12px;align-items:center}
  .topbar .right{display:flex;gap:8px;align-items:center}
  input[type=search]{padding:10px;border-radius:8px;border:1px solid var(--border);background:transparent;color:inherit;min-width:280px}
  /* Grid */
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
  .card{
    background:linear-gradient(180deg,var(--card),rgba(255,255,255,0.01));
    padding:12px;border-radius:10px;border:1px solid var(--border);display:flex;flex-direction:column;gap:8px;
    box-shadow:0 6px 18px rgba(0,0,0,0.35);
  }
  .thumb{height:160px;border-radius:8px;background:#081522;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .title{font-weight:800}
  .meta{font-size:13px;color:var(--muted)}
  .row{display:flex;gap:8px;align-items:center}
  .btn{padding:8px 10px;border-radius:8px;border:0;background:var(--accent);color:#071018;font-weight:800;cursor:pointer;transition:transform .12s ease}
  .btn:active{transform:scale(.98)}
  .btn.secondary{background:transparent;border:1px solid var(--border);color:var(--muted);font-weight:700}
  .btn.ghost{background:transparent;border:1px dashed var(--border);color:var(--muted)}
  .muted{color:var(--muted)}
  /* Panels inside sidebar */
  .side-panel{padding:12px;border-radius:8px;background:linear-gradient(180deg,transparent,rgba(255,255,255,0.01));border:1px solid var(--border)}
  /* Forms */
  label{font-size:13px;color:var(--muted);display:block;margin-top:8px}
  input[type=text], input[type=url], textarea, select, input[type=number], input[type=email]{
    width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:transparent;color:inherit;
  }
  textarea{min-height:80px;resize:vertical}
  .small-muted{font-size:12px;color:var(--muted)}
  /* Modals */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(1,4,10,0.6);z-index:1200}
  .modal.open{display:flex}
  .sheet{background:#071226;padding:18px;border-radius:10px;border:1px solid var(--border);width:100%;max-width:720px}
  /* Stats */
  .stats{display:flex;gap:12px}
  .stat{padding:10px;border-radius:8px;background:linear-gradient(180deg,transparent,rgba(255,255,255,0.01));border:1px solid var(--border);flex:1;text-align:center}
  .stat .num{font-weight:800;font-size:18px}
  /* small utilities */
  .tag{padding:4px 8px;border-radius:6px;border:1px solid var(--border);font-size:12px;color:var(--muted)}
  .notice{padding:8px;border-radius:8px;background:#081624;border:1px solid rgba(255,255,255,0.02);color:var(--muted)}
  /* helpers */
  .flex-right{display:flex;justify-content:flex-end;gap:8px}
  .muted-pill{padding:6px 10px;border-radius:999px;border:1px solid var(--border);font-size:12px}
  footer{padding:12px;text-align:center;color:var(--muted);margin-top:18px;border-top:1px solid var(--border)}
  /* responsive */
  @media (max-width:980px){
    aside.sidebar{position:relative;width:100%;display:flex;flex-direction:row;overflow:auto;height:auto;padding:10px}
    .main{margin-left:0;padding:12px}
    .grid{grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}
  }
</style>
</head>
<body>
<div class="app">

  <!-- SIDEBAR (antigo/dureza visual) -->
  <aside class="sidebar" role="navigation" aria-label="Menu principal">
    <div class="logo">
      <div class="mark">GT</div>
      <div>
        <h1>GbzStore</h1>
        <div class="small-muted">Administrador</div>
      </div>
    </div>

    <nav class="menu" role="menu">
      <button class="nav-btn active" data-tab="dashboard">Dashboard</button>
      <button class="nav-btn" data-tab="loja">Loja</button>
    </nav>

    <div class="section-title">Ações rápidas</div>
    <div class="side-panel">
      <div class="row" style="justify-content:space-between">
        <div>Jogos</div><div id="sidebar-count" class="tag">0</div>
      </div>
      <div style="margin-top:8px">
        <button id="btn-refresh" class="btn secondary">Atualizar dados</button>
        <button id="btn-clear-favs" class="btn ghost" style="float:right">Limpar favoritos</button>
      </div>
      <div style="margin-top:10px" class="small-muted">Modo anti-hack: <strong id="anti-status">ativado</strong></div>
    </div>

    <div style="margin-top:auto">
      <div class="small-muted" style="margin-bottom:6px">Versão</div>
      <div class="side-panel">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>GbzStore v2 — Painel</div>
          <div class="muted">2025</div>
        </div>
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main" role="main">
    <!-- TOPBAR -->
    <div class="topbar">
      <div class="left">
        <input id="global-search" type="search" placeholder="Pesquisar jogos, tags..." />
        <select id="sort-select" style="margin-left:8px;padding:8px;border-radius:8px;border:1px solid var(--border);background:transparent;color:inherit">
          <option value="newest">Mais recentes</option>
          <option value="name">Nome A→Z</option>
        </select>
        <button id="open-stats" class="btn secondary" style="margin-left:8px">Ver Estatísticas</button>
      </div>
      <div class="right">
        <button id="open-favs" class="btn ghost">Favoritos (<span id="fav-count">0</span>)</button>
      </div>
    </div>

    <!-- TABS / VIEWS -->
    <section id="dashboard" class="view">
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <div style="flex:1">
          <h2 style="margin:0 0 8px 0">Painel</h2>
          <div class="notice">Painel principal — resumo dos jogos e ações.</div>
        </div>
        <div style="width:320px">
          <div class="side-panel">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div><strong>Total de jogos</strong></div>
              <div id="total-games" class="num">0</div>
            </div>
            <div style="margin-top:10px;display:flex;gap:8px">
              <button id="btn-export" class="btn secondary">Exportar JSON</button>
              <!-- Purge removido conforme pedido -->
            </div>
          </div>
        </div>
      </div>

      <div style="margin-top:16px" class="stats">
        <div class="stat">
          <div class="muted">Jogos publicados</div>
          <div id="stat-published" class="num">0</div>
        </div>
        <div class="stat">
          <div class="muted">Favoritos salvos</div>
          <div id="stat-favs" class="num">0</div>
        </div>
        <div class="stat">
          <div class="muted">Espaço</div>
          <div class="num">—</div>
        </div>
      </div>

      <div style="margin-top:18px">
        <h3 style="margin:6px 0">Últimos jogos</h3>
        <div id="recent-grid" class="grid"></div>
      </div>
    </section>

    <section id="loja" class="view" style="display:none">
      <h2>Loja — catálogo</h2>
      <div id="catalog" class="grid"></div>
      <div id="empty" class="card muted" style="display:none">Nenhum jogo encontrado.</div>
    </section>
  </main>
</div>

<footer>© 2025 GbzStudio — Painel Admin • design antigo preservado</footer>

<!-- REPORT MODAL (kept minimal for quick reporting) -->
<div id="modal-report" class="modal" aria-hidden="true">
  <div class="sheet" role="dialog" aria-modal="true">
    <h3>Enviar denúncia</h3>
    <label>Link do jogo / ID</label>
    <input id="r-link" type="text"/>
    <label>Motivo</label>
    <textarea id="r-reason"></textarea>
    <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
      <button id="r-cancel" class="btn secondary">Cancelar</button>
      <button id="r-send" class="btn">Enviar denúncia</button>
    </div>
    <div id="r-msg" class="small-muted" style="margin-top:8px"></div>
  </div>
</div>

<script>
/* =========================
   (Opcional) Firebase config - descomente e ajuste se desejar usar
   =========================
const firebaseConfig = {
  // ... coloque aqui seu config se quiser
};
if(window.firebase && firebase.initializeApp) {
  try { firebase.initializeApp(firebaseConfig); } catch(e){}
}
const db = (window.firebase && firebase.database) ? firebase.database() : null;
========================= */

/* =========================
   STATE + HELPERS
   ========================= */
let gamesCache = []; // local cache
const GAMES_PATH = 'games';
const SETTINGS_PATH = 'settings';

// DOM helpers
const qs = s => document.querySelector(s);
const qsa = s => Array.from(document.querySelectorAll(s));
const el = (t,c,html)=>{const e=document.createElement(t);if(c) e.className=c; if(html!==undefined) e.innerHTML=html; return e;};

// basic sanitizers (client-side)
function sanitizeText(str){
  if(!str) return '';
  return String(str).replace(/<script.*?>.*?<\/script>/gi,'').replace(/<\/?[^>]+(>|$)/g,"").trim();
}
function isValidUrl(u){
  try{ const url = new URL(u); return ['http:','https:'].includes(url.protocol); }catch(e){return false;}
}

/* =========================
   NAV / VIEW HANDLING
   ========================= */
qsa('.nav-btn').forEach(btn=>{
  btn.addEventListener('click', e=>{
    qsa('.nav-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const tab = btn.getAttribute('data-tab');
    qsa('.view').forEach(v=>v.style.display='none');
    const view = document.getElementById(tab);
    if(view) view.style.display = 'block';
    window.scrollTo({top:0, behavior:'smooth'});
  });
});

/* =========================
   RENDER: catalog cards
   ========================= */
function placeholderSVG(text){
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='450'><rect width='100%' height='100%' fill='#071626'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='#9fd3e6' font-size='28' font-family='Arial'>${text}</text></svg>`;
  return 'data:image/svg+xml;utf8,'+encodeURIComponent(svg);
}

function renderCatalog(list){
  const catalog = qs('#catalog');
  const recent = qs('#recent-grid');
  const empty = qs('#empty');
  catalog.innerHTML = ''; recent.innerHTML = '';
  if(!list || list.length===0){
    empty.style.display = 'block';
  } else {
    empty.style.display = 'none';
  }
  list.forEach(item=>{
    const height = item.height || 160;
    const card = el('div','card');
    const thumb = el('div','thumb');
    const img = document.createElement('img');
    img.alt = item.name || 'thumb';
    img.src = (item.img && isValidUrl(item.img)) ? item.img : placeholderSVG(item.name || 'Game');
    img.style.height = (height)+'px';
    thumb.appendChild(img);
    const title = el('div','title', sanitizeText(item.name || '—'));
    const desc = el('div','meta', sanitizeText(item.desc || item.tag || ''));
    const bottom = el('div','row');
    const linkBtn = el('button','btn ghost','Abrir');
    linkBtn.addEventListener('click', ()=> window.open(item.link || '#','_blank'));
    const favBtn = el('button','btn secondary','♥');
    favBtn.title = 'Favoritar';
    favBtn.addEventListener('click', ()=> toggleFavorite(item.id));
    bottom.appendChild(linkBtn); bottom.appendChild(favBtn);

    card.appendChild(thumb);
    card.appendChild(title);
    card.appendChild(desc);
    card.appendChild(bottom);

    catalog.appendChild(card);

    // recent list (smaller copy)
    const rcard = card.cloneNode(true);
    recent.appendChild(rcard);
  });
  qs('#sidebar-count').textContent = list.length;
  qs('#total-games').textContent = list.length;
  qs('#stat-published').textContent = list.length;
}

/* =========================
   FAVORITES (localStorage)
   ========================= */
function getFavorites(){
  try{ const s = localStorage.getItem('gbz_favs'); return s ? JSON.parse(s) : []; }catch(e){return [];}
}
function saveFavorites(arr){ localStorage.setItem('gbz_favs', JSON.stringify(arr)); qs('#fav-count').textContent = arr.length; qs('#stat-favs').textContent = arr.length;}
function toggleFavorite(id){
  if(!id) return;
  let favs = getFavorites();
  if(favs.includes(id)){
    favs = favs.filter(x=>x!==id);
  } else {
    favs.push(id);
  }
  saveFavorites(favs); renderFavorites();
}
function renderFavorites(){
  const favGrid = el('div');
  favGrid.id = 'fav-temp';
  favGrid.innerHTML = '';
  const favs = getFavorites();
  qs('#fav-count').textContent = favs.length;
  qs('#stat-favs').textContent = favs.length;
  favs.forEach(fid=>{
    const item = gamesCache.find(g=>g.id===fid);
    if(!item) return;
    const card = el('div','card');
    const thumb = el('div','thumb');
    const img = document.createElement('img');
    img.src = item.img || placeholderSVG(item.name || 'Game');
    img.style.height = (item.height || 160)+'px';
    thumb.appendChild(img);
    const title = el('div','title',item.name);
    const open = el('button','btn','Abrir');
    open.addEventListener('click', ()=> window.open(item.link || '#','_blank'));
    const remove = el('button','btn ghost','Remover');
    remove.addEventListener('click', ()=> { toggleFavorite(item.id); });
    card.append(thumb, title, open, remove);
    favGrid.appendChild(card);
  });
  // quick show in recent-grid if user opens favorites via button
  const existing = qs('#fav-temp');
  if(existing) existing.replaceWith(favGrid);
  else document.body.appendChild(favGrid); // hidden fallback
}

/* =========================
   REPORT MODAL (minimal)
   ========================= */
function openReportModal(link){
  qs('#modal-report').classList.add('open');
  qs('#modal-report').setAttribute('aria-hidden','false');
  qs('#r-link').value = link || '';
  qs('#r-reason').value = '';
  qs('#r-msg').textContent = '';
}
qs('#r-cancel').addEventListener('click', ()=>{
  qs('#modal-report').classList.remove('open');
  qs('#modal-report').setAttribute('aria-hidden','true');
});
qs('#r-send').addEventListener('click', ()=>{
  const link = sanitizeText(qs('#r-link').value);
  const reason = sanitizeText(qs('#r-reason').value);
  if(!link || !reason) { qs('#r-msg').textContent = 'Preencha link e motivo.'; return; }
  // If using Firebase, push to reports path. Otherwise just show success.
  try{
    if(window.db){ db.ref('reports').push({link,reason,ts:Date.now()}); }
    qs('#r-msg').textContent = 'Denúncia registrada.';
    setTimeout(()=>{ qs('#modal-report').classList.remove('open'); qs('#modal-report').setAttribute('aria-hidden','true'); }, 900);
  }catch(e){
    qs('#r-msg').textContent = 'Denúncia registrada (local).';
    setTimeout(()=>{ qs('#modal-report').classList.remove('open'); qs('#modal-report').setAttribute('aria-hidden','true'); }, 900);
  }
});

/* =========================
   DB LISTENERS: (light, if firebase enabled)
   - If firebase is not present, we simulate empty state.
   ========================= */
function setupDbListeners(){
  if(window.db){
    // real-time games listener if Firebase available
    db.ref(GAMES_PATH).on('value', snapshot=>{
      const val = snapshot.val() || {};
      gamesCache = Object.keys(val).map(k=>Object.assign({id:k}, val[k]));
      gamesCache = gamesCache.map(g=>({
        id: g.id,
        name: g.name || g.nome || '',
        desc: g.desc || '',
        img: g.img || g.imagem || '',
        link: g.link || g.link || g.url || '',
        tag: g.tag || '',
        height: g.height || 160,
        ts: g.ts || Date.now()
      }));
      gamesCache.sort((a,b)=> (b.ts||0) - (a.ts||0));
      renderCatalog(gamesCache);
      renderFavorites();
    });
  } else {
    // no firebase -> keep empty initial state (you can populate gamesCache manually here)
    gamesCache = [];
    renderCatalog(gamesCache);
    renderFavorites();
  }
}

/* =========================
   ACTION BUTTONS
   ========================= */
qs('#btn-refresh').addEventListener('click', ()=> { /* if firebase, listeners are live */ qs('#open-stats').textContent = 'Atualizado'; setTimeout(()=>qs('#open-stats').textContent='Ver Estatísticas',800); });
qs('#btn-clear-favs').addEventListener('click', ()=> { localStorage.removeItem('gbz_favs'); saveFavorites([]); renderFavorites(); });
qs('#open-favs').addEventListener('click', ()=>{
  // open Favorites "view" quick: show favorites in recent-grid
  const favs = getFavorites();
  if(favs.length===0){
    alert('Nenhum favorito salvo.');
    return;
  }
  const list = gamesCache.filter(g=> favs.includes(g.id));
  renderCatalog(list);
  // switch to Loja tab for visualization
  qsa('.nav-btn').forEach(b=>b.classList.remove('active'));
  qsa('.nav-btn[data-tab="loja"]').forEach(b=>b.classList.add('active'));
  qsa('.view').forEach(v=>v.style.display='none');
  qs('#loja').style.display = 'block';
});
qs('#btn-export').addEventListener('click', ()=>{
  const data = JSON.stringify(gamesCache, null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'gbz-games-export.json'; a.click();
  URL.revokeObjectURL(url);
});

/* =========================
   SEARCH & SORT
   ========================= */
qs('#global-search').addEventListener('input', applyFilters);
qs('#sort-select').addEventListener('change', applyFilters);
function applyFilters(){
  const q = qs('#global-search').value.trim().toLowerCase();
  let list = gamesCache.slice();
  if(q){
    list = list.filter(i => (i.name && i.name.toLowerCase().includes(q)) || (i.tag && i.tag.toLowerCase().includes(q)) || (i.desc && i.desc.toLowerCase().includes(q)));
  }
  const sort = qs('#sort-select').value;
  if(sort === 'name') list.sort((a,b)=> (a.name||'').localeCompare(b.name||'','pt-BR'));
  else list.sort((a,b)=> (b.ts||0) - (a.ts||0));
  renderCatalog(list);
}

/* render initial favorites count */
saveFavorites(getFavorites());

/* =========================
   BASIC ANTI-HACK / INTEGRITY DETECTIONS
   (Client-side: detect DevTools, detect DOM mutation)
   ========================= */
let devtoolsOpen = false;
function detectDevTools(){
  const threshold = 160;
  const widthThreshold = window.outerWidth - window.innerWidth > threshold;
  const heightThreshold = window.outerHeight - window.innerHeight > threshold;
  devtoolsOpen = widthThreshold || heightThreshold;
  try{
    const start = performance.now();
    debugger;
    const elapsed = performance.now() - start;
    if(elapsed > 100) devtoolsOpen = true;
  }catch(e){}
  qs('#anti-status').textContent = (devtoolsOpen ? 'detectado' : 'ativado');
  if(devtoolsOpen){ // basic UI lock
    if(qs('#btn-export')) qs('#btn-export').disabled = true;
  } else {
    if(qs('#btn-export')) qs('#btn-export').disabled = false;
  }
}
setInterval(detectDevTools, 1500);

const originalHTML = document.documentElement.innerHTML.slice(0, 4000);
const mo = new MutationObserver(muts=>{
  for(const m of muts){
    if(m.addedNodes && m.addedNodes.length){
      for(const n of m.addedNodes){
        if(n.tagName && n.tagName.toLowerCase()==='script'){
          console.warn('Script injection detected', n);
          try{ if(window.db) db.ref('intrusions').push({type:'script-inject', html: (n.src || n.innerText||'inline'), ts: Date.now(), ua: navigator.userAgent}); }catch(e){}
          try{ n.parentNode.removeChild(n); }catch(e){}
        }
      }
    }
  }
});
mo.observe(document.documentElement, {childList:true, subtree:true});

/* =========================
   INIT
   ========================= */
setupDbListeners();
applyFilters();

/* small helpers on load */
window.addEventListener('load', ()=> {
  // make nav buttons work on load (ensure default shown)
  qsa('.nav-btn').forEach(b=>b.classList.remove('active'));
  qsa('.nav-btn[data-tab="dashboard"]').forEach(b=>b.classList.add('active'));
  qsa('.view').forEach(v=>v.style.display='none');
  qs('#dashboard').style.display = 'block';
});
</script>
</body>
</html>
